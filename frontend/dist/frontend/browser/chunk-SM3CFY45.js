import{a as G}from"./chunk-LY47KOC7.js";import{$ as M,$a as f,H as O,Ia as E,J as P,Lb as N,Ma as g,Mb as L,Nb as $,Ob as F,Pb as z,Rb as U,Ta as l,U as C,Ua as i,Va as n,Xa as w,Ya as k,Za as I,_ as S,_a as d,ac as B,eb as u,fb as a,gb as v,hb as x,ib as D,j as b,m as _,pb as c,q as h,qb as m,r as A,rb as T,ta as o,y}from"./chunk-TMWIUII4.js";function q(p,e){if(p&1){let t=I();i(0,"button",14),d("click",function(){S(t);let s=f().$implicit,V=f(2);return M(V.cancelAppointment(s.id))}),a(1," Cancella Appuntamento "),n()}}function R(p,e){if(p&1&&(i(0,"div",8)(1,"div",9)(2,"span",10),a(3),n(),i(4,"span",11),a(5),n()(),i(6,"div",12)(7,"p")(8,"span"),a(9,"Barbiere:"),n(),i(10,"strong"),a(11),n()(),i(12,"p")(13,"span"),a(14,"Data:"),n(),i(15,"strong"),a(16),c(17,"date"),n()(),i(18,"p")(19,"span"),a(20,"Ora:"),n(),i(21,"strong"),a(22),n()(),i(23,"p")(24,"span"),a(25,"Durata:"),n(),i(26,"strong"),a(27),n()()(),g(28,q,2,0,"button",13),c(29,"async"),n()),p&2){let t=e.$implicit,r=f(2);o(3),v((t.service==null?null:t.service.nome)||"Servizio"),o(),l("ngClass",r.getAppointmentStatusClass(t)),o(),x(" ",t.stato," "),o(6),D("",t.barber==null?null:t.barber.nome," ",t.barber==null?null:t.barber.cognome),o(5),v(T(17,9,t.data,"dd/MM/yyyy")),o(6),v(t.orarioInizio),o(5),x("",t.service==null?null:t.service.durata," min"),o(),l("ngIf",m(29,12,r.selectedFilter$)==="UPCOMING")}}function H(p,e){p&1&&(i(0,"div",15)(1,"div",16),a(2,"\u{1F4C5}"),n(),i(3,"h3"),a(4,"Nessun appuntamento"),n(),i(5,"p"),a(6,"Non ci sono appuntamenti in questa categoria."),n()())}function J(p,e){if(p&1&&(w(0),g(1,R,30,14,"div",6)(2,H,7,0,"div",7),k()),p&2){let t=e.ngIf;o(),l("ngForOf",t),o(),l("ngIf",t.length===0)}}var j=class p{apiService=C(G);authService=C(B);refreshAppointments$=new b(void 0);selectedFilter$=new b("UPCOMING");appointments$=this.refreshAppointments$.pipe(P(()=>{let e=this.authService.getDecodedToken();return!e||typeof e.id!="number"?_([]):this.apiService.getAppointmentsByUserId(e.id)}),y(e=>(console.error("Error fetching appointments:",e),_([]))),O(1));filteredAppointments$=A([this.appointments$,this.selectedFilter$]).pipe(h(([e,t])=>e.filter(r=>{let s=this.getAppointmentDateTime(r);switch(t){case"UPCOMING":return this.isUpcoming(r);case"CANCELED":return r.stato==="ANNULLATO";case"PAST":return r.stato!=="ANNULLATO"&&!!s&&s<new Date;default:return!1}})));ngOnInit(){}setFilter(e){this.selectedFilter$.next(e)}cancelAppointment(e){confirm("Sei sicuro di voler cancellare questo appuntamento?")&&this.apiService.cancelAppointment(e).subscribe(()=>{this.refreshAppointments$.next()},t=>{console.error("Error canceling appointment:",t)})}getAppointmentStatusClass(e){return`badge-${e.stato?.toLowerCase()??"pending"}`}isUpcoming(e){if(e.stato!=="CONFERMATO")return!1;let t=this.getAppointmentDateTime(e);return!!t&&t>=new Date}getAppointmentDateTime(e){let t=e.data instanceof Date?e.data.toISOString().split("T")[0]:e.data;if(!t||!e.orarioInizio)return null;let r=new Date(`${t}T${e.orarioInizio}`);return isNaN(r.getTime())?null:r}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=E({type:p,selectors:[["app-appointment-list"]],decls:17,vars:15,consts:[[1,"appointments-container"],[1,"header-section"],[1,"filter-tabs"],[1,"filter-chip",3,"click"],[1,"appointments-grid"],[4,"ngIf"],["class","appointment-card",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"appointment-card"],[1,"appointment-header"],[1,"service-name"],[1,"status-badge",3,"ngClass"],[1,"appointment-details"],["class","btn-cancel btn-danger",3,"click",4,"ngIf"],[1,"btn-cancel","btn-danger",3,"click"],[1,"empty-state"],[1,"empty-icon"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"h2"),a(3,"I Miei Appuntamenti"),n(),i(4,"div",2)(5,"button",3),c(6,"async"),d("click",function(){return r.setFilter("UPCOMING")}),a(7," Da fare "),n(),i(8,"button",3),c(9,"async"),d("click",function(){return r.setFilter("CANCELED")}),a(10," Annullati "),n(),i(11,"button",3),c(12,"async"),d("click",function(){return r.setFilter("PAST")}),a(13," Passati "),n()()(),i(14,"div",4),g(15,J,3,2,"ng-container",5),c(16,"async"),n()()),t&2&&(o(5),u("active",m(6,7,r.selectedFilter$)==="UPCOMING"),o(3),u("active",m(9,9,r.selectedFilter$)==="CANCELED"),o(3),u("active",m(12,11,r.selectedFilter$)==="PAST"),o(4),l("ngIf",m(16,13,r.filteredAppointments$)))},dependencies:[U,N,L,$,F,z],styles:[".appointments-container[_ngcontent-%COMP%]{padding:var(--spacing-md);padding-bottom:80px;min-height:100vh}.header-section[_ngcontent-%COMP%]{margin-bottom:var(--spacing-lg);position:sticky;top:0;background:#ffffffe6;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:10;padding:var(--spacing-sm) 0;margin-left:calc(var(--spacing-md) * -1);margin-right:calc(var(--spacing-md) * -1);padding-left:var(--spacing-md);padding-right:var(--spacing-md);border-bottom:1px solid rgba(0,0,0,.05)}.header-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.75rem;color:var(--color-text-primary);margin-bottom:var(--spacing-md)}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);overflow-x:auto;padding-bottom:var(--spacing-xs);-webkit-overflow-scrolling:touch;scrollbar-width:none}.filter-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.filter-chip[_ngcontent-%COMP%]{white-space:nowrap;padding:.6rem 1.25rem;border-radius:var(--radius-full);background:#ffffff80;border:1px solid rgba(0,0,0,.1);color:var(--color-text-secondary);font-weight:600;font-size:.9rem;transition:all var(--transition-fast);cursor:pointer}.filter-chip.active[_ngcontent-%COMP%]{background:var(--color-primary);color:var(--color-white);border-color:var(--color-primary);box-shadow:var(--shadow-primary)}.appointments-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--spacing-md)}.appointment-card[_ngcontent-%COMP%]{background:var(--color-surface);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border:1px solid var(--color-surface-border);border-radius:var(--radius-lg);padding:var(--spacing-md);box-shadow:var(--shadow-sm);transition:transform var(--transition-fast)}.appointment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-sm);padding-bottom:var(--spacing-xs);border-bottom:1px solid rgba(0,0,0,.05)}.service-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;color:var(--color-text-primary)}.status-badge[_ngcontent-%COMP%]{font-size:.75rem;padding:4px 8px;border-radius:var(--radius-sm);font-weight:600;text-transform:uppercase}.badge-confirmato[_ngcontent-%COMP%]{background:#388e3c1a;color:var(--color-success)}.badge-pending[_ngcontent-%COMP%]{background:#ff8c001a;color:var(--color-primary)}.badge-annullato[_ngcontent-%COMP%]{background:#d32f2f1a;color:var(--color-error)}.appointment-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0;font-size:.95rem;color:var(--color-text-secondary);display:flex;justify-content:space-between}.appointment-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--color-text-primary)}.btn-cancel[_ngcontent-%COMP%]{margin-top:var(--spacing-md);width:100%;padding:.75rem;font-size:.9rem;background:#d32f2f1a;color:var(--color-error);border:1px solid rgba(211,47,47,.2);border-radius:var(--radius-md);font-weight:600;cursor:pointer;transition:all var(--transition-fast)}.btn-cancel[_ngcontent-%COMP%]:active{background:#d32f2f33;transform:scale(.98)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--spacing-xl);color:var(--color-text-secondary);grid-column:1 / -1}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:var(--spacing-sm);opacity:.5}"],changeDetection:0})};export{j as AppointmentListComponent};
